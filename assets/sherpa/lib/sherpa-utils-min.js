Sherpa.counter("Sherpa Utils");"use strict";Sherpa.componentJS={};Sherpa.uuid=function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};Sherpa.sessionID=Sherpa.uuid();Sherpa.msg=function(a,b){var e=viewModel.content[a],d=/\{[0-9]\}*/,c=0;if(b){if(_.isObject(b)&&!_.isArray(b)){b=b()}if(_.isArray(b)&&e){while(e.match(d)){e=e.replace(e.match(d),b[c]);c++}}else{if(!_.isNaN(parseInt(b))){e=viewModel.content[a+"_plural"];if(e){if(b>1){e=e.replace(e.match(d),b)}else{e=viewModel.content[a+"_singular"]}}else{e=e.replace(e.match(d),b)}}else{e=e.replace(e.match(d),b)}}}if(!e){e='<span title="Missing textkey: '+a+'">Lorem ispum...</span>'}return e};Sherpa.linkedmsg=function(a,c){var h=Sherpa.msg(a,c),f=0,b=false,d,g=[],e=/\[(.*?)\]/;while(!b){d=viewModel.resources[a+"_url_"+f];if(d){g.push(d);f++}else{b=true}}if(g.length){_.each(g,function(i){var j,l,k;j=h.match(e)[0],l=h.match(e)[1],k='<a href="'+i+'">'+l+"</a>",h=h.replace(j,k)})}return h};Sherpa.formatCurrency=function(a){Sherpa.ready("i18n",function(){var c,e,b;if(_.isObject(a)){try{c=parseFloat(a.amount);if(a.format){if(a.format=="decimal"){e=a.format}else{e="nodecimal"}}}catch(d){Sherpa.QA.logEntry("Bad formatcurrency: data-bind:=\"formatcurrency: {'amount': amount_var, 'format' : 'decimal'}","functions, format error,sherpa-utils:formatCurrency")}}else{e="nodecimal";c=Math.ceil(a)}try{e=viewModel.config.currency["format_"+e];c=c*viewModel.config.currency.conversion_rate;c=_.str.numberFormat(c,e.decimals,e.decimal_separator,e.thousands_separator);b=viewModel.config.currency.symbol_position;if(b=="left"){return viewModel.config.currency.symbol+c}else{return c+viewModel.config.currency.symbol}}catch(d){Sherpa.QA.logEntry("Looks like you don't have currency configuration in assets/config/settings_"+viewModel.locale+".json","i18n, ajax errors, sherpa-utils:formatCurrency");return{status:"failed",error_msg:error_msg}}})};Sherpa.dateFormat=function(a){Sherpa.ready("i18n",function(){var c;if(_.isObject(a)){try{c=a.format;a=a.date}catch(b){Sherpa.QA.logEntry("Bad formatdate: data-bind:=\"formatdate: {'date': date_var, 'format' : 'dddd, mmmm dd, yyyy'}","functions, format error, sherpa-utils:dateFormat");a=new Date();c=viewModel.config.default_date_format}}else{c=viewModel.config.default_date_format}return dateFormat(a,c)})};Sherpa.urlQuery=function(){if(location.search){var c,b={},a;c=location.search.replace(/\?|\//g,"");a=c.split("&");_.each(a,function(f){var e=f.split("="),d,g;d=e[0];g=e[1];if(g){b[d]=g}else{b[d]=""}});return b}else{return false}};var responseHTMLSample="";Sherpa.insertComponent=function(h,d,e,f,i){var b,a="",g,c=h+"_"+d+"_js";if(viewModel.localhost){a="#"+Sherpa.uuid()}if(d){b=d+".html"+a}else{b=h+".html"+a}Sherpa.request({resourceId:"getComponentHTML",data:{filename:"components/"+h+"/"+b},success:function(k,j){if(!_.isUndefined(Sherpa.componentJS[c])){k=k.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");$(e).html(k)}else{Sherpa.componentJS[c]=true;$(e).html(k)}if(i){f.component_options=i}ko.applyBindingsToDescendants(f,e);Sherpa.publish("register_page_event",h)},error:function(k,j){b=b.split("#")[0];Sherpa.QA.logEntry("Missing component: filename components/"+h+"/"+b+" does not exist","missing component, sherpa-utils:insertComponent");var l='<div class="rounded-small red-stroke gray da-all da-padin"><h4>Missing Component</h4> <p>components/'+h+"/"+b+" does not exist</p></div>";$(e).html(l)}})};Sherpa.equalizeHeight=function(b,c){var a=0,d;d=$(b),_.each(d,function(e){$(e).height()>a&&(a=$(e).height())}),c&&(a+=c),_.each(d,function(e){$(e).height(a)})};Sherpa.check_condition=function(b){var c=false,a=!(_.isUndefined(b["if"])&&_.isUndefined(b.ifnot));if(a){if(!_.isUndefined(b["if"])){c=b["if"]}else{c=!b.ifnot}}else{c=true}return c};Sherpa.loadComponentJS=function(b,a){Sherpa.js(SHERPA.COMPONENTS_PATH+b+"/"+b+".js",a)};Sherpa.namespace=function(d,b,a){for(var c in d){if(_.contains(a,c)){if(typeof Sherpa[c]=="undefined"){Sherpa[c]=d[c]}else{Sherpa.QA.logEntry(c+" of "+b+" aready exists on Sherpa.","namespace collision, sherpa-utils:namespace")}}else{console.log(c+" of "+b+" is excluded from Sherpa namespace.")}}};Sherpa.ready("amplify",function(){var a=["publish","subscribe","unsubscribe","store","request"];Sherpa.namespace(amplify,"amplify",a)});Sherpa.ready("sherpaEventManager",function(){var a=["debug","register","extend","scope","attach"];Sherpa.namespace(Eve,"Eve",a)});Sherpa.ready("csvParser",function(){var a=["defaults","hooks","parsers","toArray","toArrays","toObjects","fromArrays","fromObjects2CSV"];Sherpa.namespace($.csv,"jQuery-CSV",a)});Sherpa.request.define("getComponentHTML","ajax",{url:"{filename}",dataType:"html",type:"GET"});Sherpa.request.define("supportAutocomplete","ajax",{url:"data-api/support_products.json",dataType:"json",type:"GET"});Sherpa.request.define("assets","ajax",{url:"assets/{directory}/{type}_{locale}.json",dataType:"json",type:"GET"});Sherpa.request.define("data","ajax",{url:"assets/data/{filename}",dataType:"text",type:"GET"});Sherpa.session={};Sherpa.session.storeLog=function(b,e){var c=Sherpa.store("sessionLog");if(e){if(!c){c={}}var a={key:b,sessionID:Sherpa.sessionID,id:e};c[e]=a;Sherpa.store("sessionLog",c)}else{if(!c){return undefined}else{try{return _.find(c,function(f){return f.key==b&&f.sessionID==Sherpa.sessionID}).id}catch(d){return undefined}}}};Sherpa.session.store=function(b,c){if(c){var a={key:b,data:c,sessionID:Sherpa.sessionID},d=Sherpa.uuid();Sherpa.store(d,a);Sherpa.session.storeLog(b,d);return d}else{var d=Sherpa.session.storeLog(b);if(d){return Sherpa.store(d).data}else{return undefined}}};Sherpa.session.storeCleanUp=function(){var a=Sherpa.store("sessionLog");if(a){_.each(a,function(b){if(b.sessionID!=Sherpa.sessionID){Sherpa.store(b.id,null)}})}};Sherpa.counter("Sherpa Utils");